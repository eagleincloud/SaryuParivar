<!doctype html>
{% load static %}
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="/media/saryu-parivaar-logo.png?v=4">
  <title>Saryu Parivar - Candidate Form</title>
  <link rel="stylesheet" href="https://unpkg.com/simplebar@latest/dist/simplebar.css"/>
  <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/metisMenu/3.0.7/metisMenu.min.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" />
  <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
</head>
<body class=" bg-[#ffecce]">

  <!-- dashboard -->
  <section class="wrapper">
    <div class="sidebar_wrapper" data-simplebar>
      <div class="simplebar-wrapper">
        <div class="simplebar-height-auto-observer-wrapper">
          <div class="simplebar-height-auto-observer"></div>
        </div>
        <div class="simplebar-mask">
          <div class="simplebar-offset">
            <div class="simplebar-content-wrapper">
              <div class="simplebar-content mm-active">
                <div class="sidebar-header">
                  <div style="position: relative; display: inline-block; padding: 12px; background: radial-gradient(circle, rgba(249, 119, 24, 0.15) 0%, transparent 75%); border-radius: 50%; box-shadow: 0 0 30px rgba(249, 119, 24, 0.2);">
                    <div style="position: relative; border-radius: 50%; overflow: hidden; padding: 4px; background: linear-gradient(135deg, rgba(249, 119, 24, 0.3) 0%, rgba(255, 255, 255, 0.1) 100%);">
                      <img src="/media/saryu-parivaar-logo.png?v=4" class="logo w-36" style="max-width: 200px; height: auto; border-radius: 50%; display: block; filter: drop-shadow(0 4px 12px rgba(249, 119, 24, 0.3)); position: relative; z-index: 1;" alt="Saryu Parivar Logo">
                      <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: 50%; box-shadow: inset 0 0 30px rgba(255, 255, 255, 0.6), inset 0 0 60px rgba(249, 119, 24, 0.2); pointer-events: none; z-index: 2;"></div>
                      <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; border-radius: 50%; background: linear-gradient(135deg, rgba(249, 119, 24, 0.4), rgba(255, 140, 66, 0.2), rgba(249, 119, 24, 0.4)); filter: blur(8px); z-index: 0; opacity: 0.7;"></div>
                    </div>
                  </div>
                  <div class="toggle-icon m-auto">
                    <i class="bx bx-arrow-to-left" id="btn"></i>
                  </div>
                </div>
                {% include 'includes/sidebar.html' %}
              </div>              
            </div>
          </div>
        </div>
        <div class="simplebar-placeholder"></div>
      </div>
      <div class="simplebar-track simplebar-horizontal" style="visibility: hidden;">
        <div class="simplebar-scrollbar" style="width: 0px; display: none;"></div>
      </div>
      <div class="simplebar-track simplebar-vertical" style="visibility: visible;">
        <div class="simplebar-scrollbar" style="height: 83px; transform: translate3d(0px, 0px, 0px); display: block;"></div>
      </div>
    </div>
    <header>
      <div class="topbar d-flex align-items-center">
        <nav class="navbar navbar-expand">
          <div class="search-bar flex-grow-1">
            <!-- <div class="position-relative search-bar-box">
              <input type="text" class="form-control search-control" placeholder="Type to search...">
              <span class="position-absolute top-50 search-show translate-middle-y">
                <i class="bx bx-search"></i>
              </span>
              <span class="position-absolute top-50 search-close translate-middle-y">
                <i class="bx bx-x"></i>
              </span>
            </div> -->
          </div>
          <!-- Payment Verification Badge -->
          {% if payment_pending or not payment_done %}
          <div class="payment-badge-container me-3">
            <a href="/payment/" class="payment-verification-badge" title="{% if payment_pending %}Payment verification pending{% else %}Payment required{% endif %}" style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; border-radius: 20px; text-decoration: none; font-size: 12px; font-weight: 600; box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3); transition: all 0.3s ease;">
              <i class="bx bx-time-five" style="font-size: 14px;"></i>
              <span class="d-none d-md-inline">{% if payment_pending %}Verification Pending{% else %}Payment Required{% endif %}</span>
              <span class="d-md-none">Pending</span>
            </a>
          </div>
          {% endif %}
          <div class="user-box dropdown">
            <a class="d-flex align-items-center nav-link dropdown-toggle dropdown-toggle-nocaret" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <img src="{{user_avatar}}" class="user-img" alt="user avatar">
              <div class="user-info ps-3">
                <p class="user-name mb-0">{{username}}</p>
                <!-- <p class="designattion mb-0">Web Designer</p> -->
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a href="{% url 'logout_user' %}" class="dropdown-item"><i class='bx bx-log-out-circle'></i> Logout</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <!-- <div class="page_wrapper">
      <div class="page-content">
        <div class="register-form-form bg-white p-10">
            <h2 class="text-4xl font-medium montserrat text-center mb-5">Edit Profile</h2>
            <div class="block sm:flex">
                <div class="mx-3 mb-3 w-full">
                  <img src="/media/qr_code.jpeg?v=4" alt="Candidate Profile" width="200px">
                </div>
            </div>
        </div>
      </div>
    </div> -->
    
    <div class="page_wrapper">
        <div class="page-content">
            <!-- Success Message After Registration -->
            {% if messages %}
                {% for message in messages %}
                    {% if 'Account created successfully' in message.message or 'success' in message.tags %}
                    <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin: 15px; border-radius: 12px; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border: 2px solid #28a745; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.2); animation: slideDown 0.5s ease-out;">
                        <div class="d-flex align-items-center">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);">
                                <i class="bx bx-check" style="font-size: 28px; color: white;"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h5 class="alert-heading mb-1 montserrat" style="color: #155724; font-weight: 700; font-size: 18px;">
                                    <i class="bx bx-party"></i> Registration Successful!
                                </h5>
                                <p class="mb-0 poppins" style="color: #155724; font-size: 14px; line-height: 1.5;">
                                    {{ message.message }}
                                </p>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="opacity: 0.7;"></button>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            {% endif %}
            
            <style>
              .payment-verification-badge:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
              }
              /* Mobile Responsive */
              @media (max-width: 768px) {
                .payment-badge-container {
                  margin-right: 8px !important;
                }
                .payment-verification-badge {
                  padding: 5px 10px !important;
                  font-size: 11px !important;
                }
                .user-box {
                  margin-left: auto;
                }
                .user-info {
                  display: none;
                }
                .topbar {
                  padding: 10px 15px !important;
                }
                .user-img {
                  width: 35px !important;
                  height: 35px !important;
                }
              }
            </style>
            
            
            <div class="register-form-form bg-white p-10 modern-card" style="border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); margin: 20px;">
                {% if payment_done and payment_transaction and payment_transaction.payment_status == 'completed' %}
                <!-- Payment Success Message -->
                <div class="text-center mb-5">
                    <div class="alert alert-success poppins" style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; border: none; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);">
                        <i class="bx bx-check-circle" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                        <h3 class="text-3xl font-bold mb-3" style="color: white;">Payment Successful!</h3>
                        <p class="mb-2" style="font-size: 18px; color: white;">Your payment has been verified and approved.</p>
                        <div class="mt-4 p-3" style="background: rgba(255,255,255,0.2); border-radius: 10px; display: inline-block;">
                            <p class="mb-1" style="font-size: 16px; font-weight: 600;">
                                <i class="bx bx-calendar-check"></i> Annual Subscription Activated
                            </p>
                            {% if payment_transaction.subscription_start_date and payment_transaction.subscription_end_date %}
                            <p class="mb-0" style="font-size: 14px;">
                                Valid until: <strong>{{ payment_transaction.subscription_end_date|date:"F d, Y" }}</strong>
                            </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <h2 class="text-4xl font-medium montserrat text-center mb-5 gradient-text">Complete Payment</h2>
                <p class="text-center poppins mb-5" style="color: #666; font-size: 16px;">
                  Scan the QR code below to make payment via UPI
                </p>
                {% endif %}
                
                {% if not payment_done or not payment_transaction or payment_transaction.payment_status != 'completed' %}
                <!-- Payment Options Tabs -->
                <div class="mb-4">
                    <ul class="nav nav-tabs justify-content-center poppins" id="paymentTabs" role="tablist" style="border-bottom: 2px solid #ffecce;">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active poppins" id="upi-tab" data-bs-toggle="tab" data-bs-target="#upi-payment" type="button" role="tab" style="color: #f97718; font-weight: 600; border: none; background: transparent; padding: 12px 20px;">
                                <i class="bx bx-qr-scan"></i> UPI Payment
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link poppins" id="bank-tab" data-bs-toggle="tab" data-bs-target="#bank-payment" type="button" role="tab" style="color: #f97718; font-weight: 600; border: none; background: transparent; padding: 12px 20px;">
                                <i class="bx bx-building"></i> Bank Transfer
                            </button>
                        </li>
                    </ul>
                </div>
                
                <div class="tab-content" id="paymentTabContent">
                    <!-- UPI Payment Tab -->
                    <div class="tab-pane fade show active" id="upi-payment" role="tabpanel">
                        <div class="text-center mb-4">
                            <div class="d-inline-block p-4" style="background: linear-gradient(135deg, #fff8e1 0%, #ffe082 100%); border-radius: 20px; box-shadow: 0 8px 24px rgba(249, 119, 24, 0.2);">
                                <img 
                                src="/media/qr_code.jpeg?v=4" 
                                alt="Payment QR Code"
                                class="img-fluid"
                                style="max-width: 350px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);"
                                onerror="this.src='/media/qr_code.jpeg?v=' + Date.now();">
                            </div>
                        </div>
                        
                        <div class="text-center mb-4">
                            <div class="alert alert-info poppins" style="background: #ffecce; border: 2px solid #f97718; color: #f97718; border-radius: 12px; padding: 15px; display: inline-block;">
                                <strong style="font-size: 18px;">Registration Fee:</strong>
                                <span style="font-size: 24px; font-weight: 700; margin-left: 10px;">₹{% if payment_amount %}{{ payment_amount|floatformat:2 }}{% else %}250.00{% endif %}</span>
                            </div>
                        </div>
                        
                        <div class="text-center mb-4">
                            <p class="poppins mb-2" style="color: #333; font-size: 16px; font-weight: 600;">
                                <i class="bx bx-credit-card"></i> UPI ID:
                            </p>
                            <p class="poppins mb-0" style="color: #f97718; font-size: 20px; font-weight: 700; background: #ffecce; padding: 10px 20px; border-radius: 10px; display: inline-block;">
                                yespay.oats9425081010@yesbankltd
                            </p>
                        </div>
                        
                        <!-- UPI Payment Options -->
                        <div class="text-center mb-4">
                            <p class="poppins mb-3" style="color: #333; font-size: 16px; font-weight: 600;">
                                <i class="bx bx-mobile"></i> Pay with UPI Apps:
                            </p>
                            <div class="d-flex flex-wrap justify-content-center gap-3">
                                <button type="button" onclick="openUPIApp('googlepay')" class="upi-payment-btn" style="background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px 20px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s; cursor: pointer; min-width: 140px; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/Google_Pay_%28GPay%29_Logo.svg/512px-Google_Pay_%28GPay%29_Logo.svg.png" alt="Google Pay" style="height: 36px; width: auto; object-fit: contain;">
                                    <span class="poppins" style="color: #333; font-size: 13px; font-weight: 600;">Google Pay</span>
                                </button>
                                <button type="button" onclick="openUPIApp('phonepe')" class="upi-payment-btn" style="background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px 20px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s; cursor: pointer; min-width: 140px; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <svg width="36" height="36" viewBox="0 0 36 36" style="display: block;">
                                        <rect width="36" height="36" rx="7" fill="#5F259F"/>
                                        <text x="18" y="24" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white" text-anchor="middle">P</text>
                                    </svg>
                                    <span class="poppins" style="color: #333; font-size: 13px; font-weight: 600;">PhonePe</span>
                                </button>
                                <button type="button" onclick="openUPIApp('paytm')" class="upi-payment-btn" style="background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px 20px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s; cursor: pointer; min-width: 140px; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <svg width="36" height="36" viewBox="0 0 36 36" style="display: block;">
                                        <rect width="36" height="36" rx="7" fill="#00BAF2"/>
                                        <text x="18" y="24" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="white" text-anchor="middle">Paytm</text>
                                    </svg>
                                    <span class="poppins" style="color: #333; font-size: 13px; font-weight: 600;">Paytm</span>
                                </button>
                                <button type="button" onclick="openUPIApp('amazonpay')" class="upi-payment-btn" style="background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px 20px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s; cursor: pointer; min-width: 140px; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <svg width="36" height="36" viewBox="0 0 36 36" style="display: block;">
                                        <rect width="36" height="36" rx="7" fill="#FF9900"/>
                                        <path d="M9 12l9 6-9 6V12zm18 0v12l-9-6 9-6z" fill="white"/>
                                    </svg>
                                    <span class="poppins" style="color: #333; font-size: 13px; font-weight: 600;">Amazon Pay</span>
                                </button>
                                <button type="button" onclick="openUPIApp('bhim')" class="upi-payment-btn" style="background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px 20px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s; cursor: pointer; min-width: 140px; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                    <svg width="36" height="36" viewBox="0 0 36 36" style="display: block;">
                                        <rect width="36" height="36" rx="7" fill="#6C5CE7"/>
                                        <text x="18" y="24" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">BHIM</text>
                                    </svg>
                                    <span class="poppins" style="color: #333; font-size: 13px; font-weight: 600;">BHIM</span>
                                </button>
                            </div>
                            <style>
                                .upi-payment-btn:hover {
                                    transform: translateY(-2px);
                                    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                                    border-color: #f97718 !important;
                                }
                            </style>
                        </div>
                    </div>
                    
                    <!-- Bank Transfer Tab -->
                    <div class="tab-pane fade" id="bank-payment" role="tabpanel">
                        <div class="bg-white p-5 rounded-lg" style="border: 2px solid #ffecce; border-radius: 15px;">
                            <h3 class="text-2xl font-bold poppins mb-4 text-center" style="color: #f97718;">
                                <i class="bx bx-building"></i> Bank Transfer Details
                            </h3>
                            
                            <div class="mb-4">
                                <div class="alert alert-info poppins" style="background: #ffecce; border: 2px solid #f97718; color: #f97718; border-radius: 12px; padding: 15px; display: inline-block; width: 100%;">
                                    <strong style="font-size: 18px;">Registration Fee:</strong>
                                    <span style="font-size: 24px; font-weight: 700; margin-left: 10px;">₹{% if payment_amount %}{{ payment_amount|floatformat:2 }}{% else %}250.00{% endif %}</span>
                                </div>
                            </div>
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="p-3" style="background: #fff8e1; border-radius: 10px; border-left: 4px solid #f97718;">
                                        <label class="poppins mb-1 d-block" style="color: #666; font-size: 12px; font-weight: 600;">Bank Name</label>
                                        <p class="poppins mb-0" style="color: #333; font-size: 16px; font-weight: 700;">ARIHANT URBAN CO-OPERATIVE BANK LTD.</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="p-3" style="background: #fff8e1; border-radius: 10px; border-left: 4px solid #f97718;">
                                        <label class="poppins mb-1 d-block" style="color: #666; font-size: 12px; font-weight: 600;">IFSC Code</label>
                                        <p class="poppins mb-0" style="color: #333; font-size: 16px; font-weight: 700;">HDFCOCACOBL</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="p-3" style="background: #fff8e1; border-radius: 10px; border-left: 4px solid #f97718;">
                                        <label class="poppins mb-1 d-block" style="color: #666; font-size: 12px; font-weight: 600;">Account Number</label>
                                        <p class="poppins mb-0" style="color: #333; font-size: 16px; font-weight: 700;">001100201003768</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="p-3" style="background: #fff8e1; border-radius: 10px; border-left: 4px solid #f97718;">
                                        <label class="poppins mb-1 d-block" style="color: #666; font-size: 12px; font-weight: 600;">Account Type</label>
                                        <p class="poppins mb-0" style="color: #333; font-size: 16px; font-weight: 700;">Savings Account</p>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="p-3" style="background: #fff8e1; border-radius: 10px; border-left: 4px solid #f97718;">
                                        <label class="poppins mb-1 d-block" style="color: #666; font-size: 12px; font-weight: 600;">Bank Address</label>
                                        <p class="poppins mb-0" style="color: #333; font-size: 14px;">Abhay Prashal, 10, Race Course Road, INDORE - 452 003</p>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="p-3" style="background: #fff8e1; border-radius: 10px; border-left: 4px solid #f97718;">
                                        <label class="poppins mb-1 d-block" style="color: #666; font-size: 12px; font-weight: 600;">Account Holder Name</label>
                                        <p class="poppins mb-0" style="color: #333; font-size: 16px; font-weight: 700;">SARYURARIN BRAHMAN SAAB SEWA SANSHTHA</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 p-3" style="background: #e8f5e9; border-radius: 10px; border: 1px solid #4caf50;">
                                <p class="poppins mb-0" style="color: #2e7d32; font-size: 14px;">
                                    <i class="bx bx-info-circle"></i> <strong>Note:</strong> After making the bank transfer, please upload the payment proof (cheque copy or transaction screenshot) below for faster verification.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if payment_transaction %}
                <form id="payment_verification_form" method="POST" action="/verify_payment/" enctype="multipart/form-data" class="mt-5">
                    {% csrf_token %}
                    <input type="hidden" name="transaction_id" id="payment_transaction_id" value="{{ payment_transaction.transaction_id }}">
                    
                    <div class="mb-4">
                        <label for="payment_proof" class="poppins mb-2 d-block" style="color: #333; font-weight: 600; font-size: 16px;">
                            <i class="bx bx-upload"></i> Upload Payment Proof (Optional)
                        </label>
                        <input type="file" name="payment_proof" id="payment_proof" accept="image/*" class="form-control poppins" style="border: 2px dashed #f97718; border-radius: 12px; padding: 15px; background: #fff8e1;">
                        <small class="text-muted poppins mt-2 d-block">You can upload a screenshot or photo of your payment confirmation (optional). Maximum file size: 5MB. You can also upload it later from your dashboard.</small>
                        <div id="payment-image-size-error" class="alert alert-danger mt-2 poppins" style="display: none; font-size: 12px; padding: 8px; border-radius: 8px; background: #fee; border: 1px solid #fcc;"></div>
                    </div>
                    
                    <div id="payment_status_message" class="alert" style="display: none; border-radius: 10px;"></div>
                    
                    <div class="text-center d-grid gap-2">
                        {% if payment_done and payment_transaction and payment_transaction.payment_status == 'completed' %}
                        <button type="button" id="continue_btn" onclick="continueToPortal()" class="btn btn-lg poppins fw-semibold text-white" style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); border: none; border-radius: 12px; padding: 15px 40px; font-size: 18px; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); transition: all 0.3s;">
                            <i class="bx bx-right-arrow-circle"></i> Go to Dashboard
                        </button>
                        {% else %}
                        <button type="button" id="continue_btn" onclick="continueToPortal()" class="btn btn-lg poppins fw-semibold text-white" style="background: linear-gradient(135deg, #f97718 0%, #ff8c42 100%); border: none; border-radius: 12px; padding: 15px 40px; font-size: 18px; box-shadow: 0 4px 15px rgba(249, 119, 24, 0.3); transition: all 0.3s;">
                            <i class="bx bx-right-arrow-circle"></i> Continue to Portal
                        </button>
                        <button type="button" id="submit_payment_btn" onclick="submitPaymentProof()" class="btn btn-outline-secondary poppins" style="border-radius: 12px; padding: 12px 30px; font-size: 16px;">
                            <i class="bx bx-upload"></i> Upload Payment Proof (Optional)
                        </button>
                        {% endif %}
                    </div>
                </form>
                {% endif %}
                
                {% if not payment_done or not payment_transaction or payment_transaction.payment_status != 'completed' %}
                <div class="mt-4 text-center">
                    <p class="poppins" style="color: #666; font-size: 14px;">
                        <i class="bx bx-info-circle"></i> After uploading payment proof, admin will verify your payment and grant you full access.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <script>
    // UPI Payment App Opening Function
    window.openUPIApp = function(app) {
      const upiId = 'yespay.oats9425081010@yesbankltd';
      const amount = {% if payment_amount %}{{ payment_amount|floatformat:2 }}{% else %}250.00{% endif %};
      const payeeName = 'Saryu Parivar';
      
      let upiUrl = '';
      
      switch(app) {
        case 'googlepay':
          upiUrl = `tez://upi/pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR`;
          break;
        case 'phonepe':
          upiUrl = `phonepe://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR`;
          break;
        case 'paytm':
          upiUrl = `paytmmp://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR`;
          break;
        case 'amazonpay':
          upiUrl = `amazonpay://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR`;
          break;
        case 'bhim':
          upiUrl = `bhim://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR`;
          break;
        default:
          // Universal UPI format
          upiUrl = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR`;
      }
      
      // Try to open the app
      window.location.href = upiUrl;
      
      // Fallback: If app doesn't open, show UPI ID for manual entry
      setTimeout(function() {
        if (confirm('If the app didn\'t open, please copy the UPI ID and make payment manually:\n\n' + upiId + '\n\nAmount: ₹' + amount)) {
          // Copy UPI ID to clipboard
          navigator.clipboard.writeText(upiId).then(function() {
            alert('UPI ID copied to clipboard!');
          });
        }
      }, 1000);
    };
    
    // Continue to Portal function
    window.continueToPortal = function() {
      // Redirect to dashboard/portal
      window.location.href = '/dashboard/';
    };
    
    // Payment proof submission (optional)
    window.submitPaymentProof = async function() {
      const form = document.getElementById('payment_verification_form');
      const formData = new FormData(form);
      const statusDiv = document.getElementById('payment_status_message');
      const submitBtn = document.getElementById('submit_payment_btn');
      const imageSizeError = document.getElementById('payment-image-size-error');
      const MAX_IMAGE_SIZE = 5 * 1024 * 1024; // 5MB in bytes
      
      // Check if file is selected (optional)
      const fileInput = document.getElementById('payment_proof');
      if (!fileInput.files || fileInput.files.length === 0) {
        statusDiv.className = 'alert alert-warning';
        statusDiv.textContent = 'Please select a payment proof file to upload.';
        statusDiv.style.display = 'block';
        return;
      }
      
      // Validate image size
      const file = fileInput.files[0];
      if (file && file.size > MAX_IMAGE_SIZE) {
        const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
        if (imageSizeError) {
          imageSizeError.innerHTML = `<i class="bx bx-error-circle"></i> Image file is too large (${sizeInMB} MB). Maximum allowed size is 5 MB. Please select a smaller image.`;
          imageSizeError.style.display = 'block';
          imageSizeError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        fileInput.value = ''; // Clear the file input
        return;
      } else {
        // Hide error if file is valid
        if (imageSizeError) {
          imageSizeError.style.display = 'none';
        }
      }
      
      // Add file size validation on change
      if (fileInput) {
        fileInput.addEventListener('change', function(e) {
          const selectedFile = e.target.files[0];
          if (selectedFile && selectedFile.size > MAX_IMAGE_SIZE) {
            const sizeInMB = (selectedFile.size / (1024 * 1024)).toFixed(2);
            if (imageSizeError) {
              imageSizeError.innerHTML = `<i class="bx bx-error-circle"></i> Image file is too large (${sizeInMB} MB). Maximum allowed size is 5 MB. Please select a smaller image.`;
              imageSizeError.style.display = 'block';
              imageSizeError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            e.target.value = ''; // Clear the file input
          } else {
            if (imageSizeError) {
              imageSizeError.style.display = 'none';
            }
          }
        });
      }
      
      submitBtn.disabled = true;
      submitBtn.classList.add('btn-loading');
      statusDiv.style.display = 'none';

      try {
        const baseUrl = `${window.location.protocol}//${window.location.hostname}${window.location.port ? `:${window.location.port}` : ''}`;
        const response = await fetch(`${baseUrl}/verify_payment/`, {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
          }
        });

        const data = await response.json();
        
        if (data.success) {
          statusDiv.className = 'alert alert-success';
          statusDiv.textContent = data.message || 'Payment proof uploaded successfully!';
          statusDiv.style.display = 'block';
          
          // Reload after 2 seconds
          setTimeout(() => {
            window.location.reload();
          }, 2000);
        } else {
          statusDiv.className = 'alert alert-danger';
          statusDiv.textContent = data.message || 'Failed to submit payment proof';
          statusDiv.style.display = 'block';
        }
      } catch (error) {
        console.error('Error submitting payment:', error);
        statusDiv.className = 'alert alert-danger';
        statusDiv.textContent = 'An error occurred. Please try again.';
        statusDiv.style.display = 'block';
      } finally {
        submitBtn.disabled = false;
        submitBtn.classList.remove('btn-loading');
        submitBtn.innerHTML = '<i class="bx bx-upload"></i> Upload Payment Proof (Optional)';
      }
    };
    </script>

    <footer class="bg-black py-2 text-white poppins">
      <p class="text-center">Copyright &copy; 2024 Saryu Parivar. All Rights Reserved.</p>
      <p class="text-center mb-0">Proudly designed and developed by Eagle in Cloud</p>
    </footer>
  </section>
  <!-- end of dashboard -->
 
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <script src="https://unpkg.com/simplebar@latest/dist/simplebar.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/metisMenu/3.0.7/metisMenu.min.js"></script>
  <script src="https://unpkg.com/boxicons@2.1.2/dist/boxicons.js"></script>
  <script src="{% static 'js/script.js' %}"></script>
  
  <!-- Support Widget -->
  {% include 'includes/support_widget.html' %}
</body>
</html>